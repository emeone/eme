<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>å‡ºç”£æº–å‚™ã‚¬ã‚¤ãƒ‰ Â· å˜ä¸€HTMLï¼ˆã‚¬ãƒ¼ãƒ‰å¼·åŒ–ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åè¡¨ç¤ºãƒ»è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ15åˆ†ï¼‰</title>
  <meta name="theme-color" content="#ff5c8a"/>
  <style>
    :root{ --pink:#ff5c8a; --pink-2:#ff7aa3; --yellow:#ffd54d; --mint:#34c6a1; --ink:#222; --ink-2:#555; --ink-3:#888; --line:#e9e9e9; --pill:#fafafa; --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.06); --tap:52px; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Noto Sans JP',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink);background:#fff}
    /* Login */
    #loginView{min-height:100dvh;display:none;place-items:center;background:linear-gradient(180deg,#fff7fb,#fff)}
    .card{width:min(420px,100%);background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.06);overflow:hidden}
    .card .hd{padding:16px 18px;background:#fff1f6;color:#c74363;font-weight:900}
    .card .bd{padding:18px}
    .row{display:grid;gap:10px;margin-top:10px}
    label{font-size:13px;color:#666}
    input{padding:12px;border:1px solid var(--line);border-radius:10px;font-size:16px}
    .btn{margin-top:12px;display:inline-flex;align-items:center;justify-content:center;gap:6px;width:100%;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:linear-gradient(90deg,#ff5c8a,#ff7aa3);color:#fff;font-weight:900;cursor:pointer}
    .btn.secondary{background:#fff;color:#c74363}
    .foot{padding:14px 18px;border-top:1px solid var(--line);font-size:12px;color:#666}
    .msg{margin-top:8px;font-size:13px}
    .ok{color:#0a7f56}
    .ng{color:#b24a5f}
    .help{font-size:12px;color:#666;margin-top:6px}
    /* App */
    #app{display:none}
    .head{position:sticky;top:0;z-index:60;background:#fff;border-bottom:1px solid var(--line)}
    .head .wrap{max-width:1200px;margin:0 auto;padding:8px 12px;display:flex;align-items:center;gap:8px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .logo{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--pink),var(--pink-2))}
    .name{font-family:'Rounded Mplus 1c',sans-serif;font-weight:800}
    .search{flex:1;display:flex;align-items:center;gap:8px;padding:10px 12px;background:var(--pill);border:1px solid var(--line);border-radius:999px}
    .search input{flex:1;border:none;background:transparent;outline:none;font-size:16px}
    .actions{display:flex;gap:8px;align-items:center}
    .link{display:inline-flex;align-items:center;gap:6px;min-height:var(--tap);padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#fff;color:#333;text-decoration:none;font-weight:700;font-size:14px}
    .user{font-weight:800;color:#c74363}
    .notice{background:linear-gradient(90deg,#fff7f9,#fff);border-bottom:1px solid var(--line)}
    .notice .wrap{max-width:1200px;margin:0 auto;padding:8px 12px;color:#9a3a54;font-size:13px}
    .panel{display:none}
    .panel[aria-hidden="false"]{display:block}
    .grid{max-width:1200px;margin:0 auto;padding:12px 12px 72px;display:grid;grid-template-columns:1fr;gap:12px}
    @media (min-width:960px){.grid{grid-template-columns:1fr 1fr}}
    .card2{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow)}
    .card2 .hd{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
    .ttl{font-weight:900;color:#c74363}
    .card2 .bd{padding:12px}
    .kpi{display:flex;align-items:flex-end;gap:10px}
    .big{font-family:'Rounded Mplus 1c',sans-serif;font-weight:800;font-size:40px;color:#c74363}
    .muted{color:var(--ink-3);font-size:13px}
    .row2{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .pill{flex:1;min-width:140px;background:var(--pill);border:1px solid var(--line);border-radius:14px;padding:12px;text-align:center}
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
    .stat{background:var(--pill);border:1px solid var(--line);border-radius:14px;padding:10px;text-align:center}
    .stat .v{color:#c74363;font-weight:900}
    details{border:1px solid var(--line);border-radius:12px;background:#fff;margin-top:8px}
    details>summary{list-style:none;cursor:pointer;padding:10px 12px;font-weight:900;color:#c74363;display:flex;align-items:center;gap:8px}
    details>summary::-webkit-details-marker{display:none}
    details .content{padding:8px 12px 12px}
    .tabs{position:sticky;top:54px;background:#fff;z-index:40;display:flex;gap:8px;border-bottom:2px solid var(--line);padding:0 12px;overflow-x:auto;-webkit-overflow-scrolling:touch}
    .tabs button{appearance:none;background:none;border:none;padding:14px 10px;font-weight:900;color:#444;border-bottom:3px solid transparent;cursor:pointer;flex:0 0 auto}
    .tabs button[aria-selected="true"]{color:#c74363;border-bottom-color:#ff9bbb}
    .tools{display:flex;gap:8px;flex-wrap:wrap;padding:10px 12px}
    .list{padding:0 12px 12px;display:grid;gap:10px}
    .group{border:1px solid var(--line);border-radius:14px;background:#fff}
    .group h3{margin:0;padding:12px 14px;border-bottom:1px dashed var(--line);color:#c74363;font-size:15px}
    .item{display:flex;gap:12px;padding:14px;align-items:flex-start;cursor:pointer;outline:none}
    .item:hover{background:#fff7fb}
    .item:focus{box-shadow:0 0 0 3px rgba(255,92,138,.35)}
    .item input[type="checkbox"]{position:absolute;opacity:0;width:1px;height:1px}
    .check{width:26px;height:26px;border-radius:50%;border:2px solid #ff7aa3;display:grid;place-items:center;color:#fff;flex:0 0 26px}
    .item input[type="checkbox"]:checked + .check{background:var(--mint);border-color:var(--mint)}
    .badge{display:inline-block;padding:3px 8px;background:#ff7aa3;color:#fff;border-radius:999px;font-size:11px;margin-left:6px}
    .meta{font-size:12px;color:#c1c1c1}
    .nohit{margin:0 12px 12px;padding:12px 14px;color:#9a3a54;background:#fff7fb;border:1px dashed #ffc7da;border-radius:12px}
    .info-grid{display:grid;grid-template-columns:1fr;gap:10px;padding:0 12px 12px}
    @media (min-width:960px){.info-grid{grid-template-columns:repeat(3,1fr)}}
    .info-card{border:1px solid var(--line);border-left:4px solid #ffd54d;background:#fffef6;border-radius:14px;padding:14px}
    .tabbar{position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--line);display:grid;grid-template-columns:repeat(4,1fr);height:60px;padding-bottom:calc(env(safe-area-inset-bottom));z-index:70}
    .tabbar button{appearance:none;background:none;border:none;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;font-weight:800;color:#666}
    .tabbar button[aria-selected="true"]{color:#c74363}
  </style>
  <script>
    // ===== Initial Guard (very early) =====
    // Ensure that when the page loads, we don't flash the app before auth.
    (function(){
      const SESSION_KEY = 'session_ok';
      const authed = (localStorage.getItem(SESSION_KEY) === '1');
      // Prepare minimal DOM visibility: hide both, then decide later in onload
      document.addEventListener('DOMContentLoaded', function(){
        const login = document.getElementById('loginView');
        const app = document.getElementById('app');
        if(!login || !app) return;
        if(authed){ app.style.display='block'; login.style.display='none'; }
        else { login.style.display='grid'; app.style.display='none'; }
      });
    })();
  </script>
</head>
<body>
  <!-- Login View -->
  <section id="loginView" aria-label="ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢">
    <div class="card" role="dialog" aria-labelledby="ttl" aria-describedby="desc">
      <div class="hd" id="ttl">ğŸ”’ ãƒ­ã‚°ã‚¤ãƒ³</div>
      <div class="bd">
        <p id="desc" class="help">ã“ã®ãƒ­ã‚°ã‚¤ãƒ³ã¯ <strong>ç«¯æœ«å†…ï¼ˆLocalStorageï¼‰ã§æ¤œè¨¼</strong>ã™ã‚‹ç°¡æ˜“æ–¹å¼ã§ã™ã€‚ãƒãƒƒãƒˆæ¥ç¶šã‚„å¤–éƒ¨ã‚µãƒ¼ãƒã¯ä¸è¦ã§ã™ã€‚</p>
        <div class="row">
          <label for="user">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
          <input id="user" autocomplete="username" placeholder="ä¾‹ï¼štakahiro"/>
        </div>
        <div class="row">
          <label for="pass">ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰</label>
          <input id="pass" type="password" inputmode="numeric" placeholder="4ã€œ6æ¡ç¨‹åº¦" autocomplete="current-password"/>
        </div>
        <button class="btn" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³</button>
        <div class="msg" id="msg" aria-live="polite"></div>
        <details style="margin-top:14px">
          <summary>åˆå›è¨­å®šï¼ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰å¤‰æ›´</summary>
          <div class="help">ä»¥ä¸‹ã«æ–°ã—ã„ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šã™ã‚‹ã¨ç«¯æœ«ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼ˆSHA-256ã§ãƒãƒƒã‚·ãƒ¥åŒ–ï¼‰ã€‚</div>
          <div class="row" style="margin-top:8px">
            <label for="newpass">æ–°ã—ã„ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰</label>
            <input id="newpass" type="password" inputmode="numeric" placeholder="ä¾‹ï¼š1234" autocomplete="new-password"/>
            <button class="btn" id="setpass" style="background:linear-gradient(90deg,#34c6a1,#5ad2b7);">ä¿å­˜</button>
          </div>
        </details>
      </div>
      <div class="foot">ç«¯æœ«ã‚’å¤‰æ›´ï¼ãƒ–ãƒ©ã‚¦ã‚¶åˆæœŸåŒ–ã™ã‚‹ã¨å†è¨­å®šãŒå¿…è¦ã§ã™ã€‚</div>
    </div>
  </section>

  <!-- App View -->
  <div id="app" role="application">
    <header class="head" role="banner">
      <div class="wrap">
        <div class="brand"><div class="logo" aria-hidden="true"></div><div class="name">å‡ºç”£æº–å‚™ã‚¬ã‚¤ãƒ‰</div></div>
        <div class="search" role="search">
          <span aria-hidden="true">ğŸ”</span>
          <input id="kw" placeholder="ä¾‹ï¼šå…ç«¥æ‰‹å½“ã€ãƒãƒ£ã‚¤ãƒ«ãƒ‰ã‚·ãƒ¼ãƒˆ" aria-label="ã‚µã‚¤ãƒˆå†…æ¤œç´¢ï¼ˆç”³è«‹ãƒ»æº–å‚™ãƒ»æƒ…å ±ï¼‰"/>
        </div>
        <div class="actions">
          <span class="user" id="userLabel" title="ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼"></span>
          <button class="link" id="btnLogout" title="ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
      </div>
    </header>
    <div class="notice"><div class="wrap" id="autoLogoutBanner" style="display:none">â³ ç„¡æ“ä½œ15åˆ†ã§è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚</div></div>

    <section id="panel-home" class="panel" aria-hidden="false" aria-label="ãƒ›ãƒ¼ãƒ ">
      <div class="grid">
        <article class="card2" aria-labelledby="c-ttl">
          <div class="hd"><div class="ttl" id="c-ttl">äºˆå®šæ—¥ã¾ã§ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</div><button class="link" id="btnDue2">äºˆå®šæ—¥ã‚’å¤‰æ›´</button></div>
          <div class="bd">
            <div class="kpi" aria-live="polite" aria-atomic="true" title="ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã¨ä»Šé€±ã®æƒ…å ±ã¯è‡ªå‹•æ›´æ–°ã®è¡¨ç¤ºå°‚ç”¨ã§ã™">
              <div class="big" id="daysLeft">--</div>
              <div class="muted" id="dueLabel">å‡ºç”£äºˆå®šæ—¥ã¾ã§</div>
            </div>
            <div class="row2">
              <div class="pill"><div class="muted">ç¾åœ¨</div><strong id="currentWeek">--é€±--æ—¥</strong></div>
              <div class="pill"><div class="muted">äºˆå®šæ—¥</div><strong id="dueDate">--/--</strong></div>
            </div>
            <details id="d-growth" open>
              <summary>ğŸ“ˆ ä»Šé€±ã®æˆé•·ï¼ˆã‚µã‚¤ã‚ºãƒ»ä½“é‡ãƒ»é€±æ•°ï¼‰</summary>
              <div class="content">
                <div class="stats">
                  <div class="stat"><div class="muted">å¤§ãã•</div><div class="v" id="babySize">--cm</div></div>
                  <div class="stat"><div class="muted">ä½“é‡</div><div class="v" id="babyWeight">--g</div></div>
                  <div class="stat"><div class="muted">é€±æ•°</div><div class="v" id="wk">--é€±</div></div>
                </div>
              </div>
            </details>
            <details id="d-advice" open>
              <summary>ğŸ’¡ ä»Šé€±ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹</summary>
              <div class="content">
                <ul id="adviceList" style="margin:6px 0 0 1em;padding:0"></ul>
              </div>
            </details>
            <p class="muted" style="margin:8px 0 0">â€» ã“ã®ã‚«ãƒ¼ãƒ‰ã¯è¡¨ç¤ºå°‚ç”¨ã§ã™ã€‚äºˆå®šæ—¥ã®è¨­å®šãƒ»å¤‰æ›´ã¯ã€Œäºˆå®šæ—¥ã‚’å¤‰æ›´ã€ã‹ã‚‰è¡Œã£ã¦ãã ã•ã„ã€‚</p>
          </div>
        </article>

        <article class="card2" id="timeline" aria-labelledby="t-ttl">
          <div class="hd"><div class="ttl" id="t-ttl">ã‚„ã‚‹ã“ã¨ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆå‡ºç”£å‰å¾Œï¼‰</div></div>
          <div class="bd">
            <div id="timelineList" class="timeline" style="display:grid;gap:8px"></div>
            <p class="muted" style="margin-top:6px">â€» äºˆå®šæ—¥ã‚’ã‚‚ã¨ã«å‰å¾Œã®ç›®å®‰ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚æ–½è¨­ã®æŒ‡ç¤ºãŒã‚ã‚‹å ´åˆã¯ãã¡ã‚‰ã‚’å„ªå…ˆã—ã¦ãã ã•ã„ã€‚</p>
          </div>
        </article>
      </div>
    </section>

    <section id="panel-list" class="panel" aria-hidden="true" aria-label="ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ">
      <div class="grid">
        <article class="card2" id="checklist" aria-labelledby="l-ttl">
          <div class="hd"><div class="ttl" id="l-ttl">ç”³è«‹ãƒ»æº–å‚™ãƒªã‚¹ãƒˆ</div><div class="muted" id="progress">é€²æ— --%</div></div>
          <div class="bd">
            <div class="tabs" role="tablist" aria-label="ã‚«ãƒ†ã‚´ãƒª">
              <button class="tab" role="tab" data-tab="applications" aria-selected="true" aria-controls="tabContent">ç”³è«‹æ‰‹ç¶šã</button>
              <button class="tab" role="tab" data-tab="preparation" aria-selected="false" aria-controls="tabContent">å‡ºç”£æº–å‚™</button>
              <button class="tab" role="tab" data-tab="hospital" aria-selected="false" aria-controls="tabContent">å…¥é™¢æº–å‚™</button>
            </div>
            <div class="tools">
              <button class="link" id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div id="tabContent" class="list" role="group" aria-label="ãƒã‚§ãƒƒã‚¯é …ç›®"></div>
          </div>
        </article>
      </div>
    </section>

    <section id="panel-info" class="panel" aria-hidden="true" aria-label="æƒ…å ±">
      <div class="grid">
        <article class="card2" aria-labelledby="i-ttl">
          <div class="hd"><div class="ttl" id="i-ttl">æƒ…å ±ãƒ»å•ã„åˆã‚ã›ï¼ˆæœ­å¹Œï¼‰</div></div>
          <div class="bd">
            <div class="info-grid" id="infoGrid">
              <section class="info-card" data-search="æœ­å¹Œå¸‚ å¦Šå©¦æ”¯æ´çµ¦ä»˜ ã‚³ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼ 011-213-0383 é€£çµ¡å…ˆ">
                <h3>ä¸»ãªå•ã„åˆã‚ã›å…ˆ</h3>
                <div>æœ­å¹Œå¸‚å¦Šå©¦æ”¯æ´çµ¦ä»˜ã‚³ãƒ¼ãƒ«ã‚»ãƒ³ã‚¿ãƒ¼</div>
                <div style="margin-top:6px"><a class="link" href="tel:0112130383">ğŸ“± 011-213-0383</a></div>
              </section>
              <section class="info-card" data-search="çµ¦ä»˜é‡‘ åŠ©æˆé‡‘ å‡ºç”£è‚²å…ä¸€æ™‚é‡‘ å…ç«¥æ‰‹å½“ å­ã©ã‚‚åŒ»ç™‚è²»åŠ©æˆ æœ­å¹Œ">
                <h3>çµ¦ä»˜é‡‘ãƒ»åŠ©æˆé‡‘</h3>
                <ul style="margin:0;padding-left:1.2em;line-height:1.8">
                  <li>å¦Šå©¦ã®ãŸã‚ã®æ”¯æ´çµ¦ä»˜ï¼šè¨ˆ10ä¸‡å††</li>
                  <li>å‡ºç”£è‚²å…ä¸€æ™‚é‡‘ï¼š50ä¸‡å††</li>
                  <li>å…ç«¥æ‰‹å½“ï¼šæœˆ15,000å††ã€œ</li>
                  <li>å­ã©ã‚‚åŒ»ç™‚è²»åŠ©æˆï¼š18æ­³ã¾ã§</li>
                </ul>
              </section>
              <section class="info-card" data-search="æœ­å¹Œ å†¬ é›ªé“ ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼ é¸ã³æ–¹ é˜²å¯’ åŠ æ¹¿ ä¿æ¹¿">
                <h3>æœ­å¹Œãªã‚‰ã§ã¯ã®ãƒã‚¤ãƒ³ãƒˆ</h3>
                <ul style="margin:0;padding-left:1.2em;line-height:1.8">
                  <li>é›ªé“ã¯â€œå¤§å¾„ã‚¿ã‚¤ãƒ¤ï¼ã‚¹ãƒãƒ¼ã‚½ãƒƒã‚¯ã‚¹â€å¯¾å¿œã®ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼ãŒå®‰å…¨</li>
                  <li>å®¤å†…ã¯ä¹¾ç‡¥ã—ã‚„ã™ã„ã®ã§åŠ æ¹¿å™¨ã¨ä¿æ¹¿ã‚±ã‚¢ã‚’å¾¹åº•</li>
                  <li>å¤–å‡ºæ™‚ã¯ãƒãƒƒã‚¯ã‚¦ã‚©ãƒ¼ãƒãƒ¼ãƒ»æ‰‹è¢‹ãªã©å†·ãˆå¯¾ç­–ã‚’</li>
                  <li>å†¬å­£ã®ç§»å‹•ã¯æ™‚é–“ã«ä½™è£•ã‚’æŒã¤ï¼ˆè·¯é¢çŠ¶æ³ã«æ³¨æ„ï¼‰</li>
                </ul>
              </section>
            </div>
          </div>
        </article>
      </div>
    </section>

    <nav class="tabbar" role="tablist" aria-label="ãƒ¡ã‚¤ãƒ³">
      <button class="tabmain" data-target="panel-home" aria-selected="true" aria-controls="panel-home" tabindex="0">ğŸ <span style="font-size:11px">ãƒ›ãƒ¼ãƒ </span></button>
      <button class="tabmain" data-target="panel-list" aria-selected="false" aria-controls="panel-list" tabindex="-1">ğŸ“<span style="font-size:11px">ãƒªã‚¹ãƒˆ</span></button>
      <button class="tabmain" data-target="panel-info" aria-selected="false" aria-controls="panel-info" tabindex="-1">â„¹ï¸<span style="font-size:11px">æƒ…å ±</span></button>
      <button class="tabmain" id="btnDue" aria-selected="false" tabindex="-1">ğŸ“…<span style="font-size:11px">äºˆå®šæ—¥</span></button>
    </nav>
  </div>

  <!-- Modal inline -->
  <div class="modal" id="dlg" role="dialog" aria-modal="true" aria-labelledby="dlgTitle" aria-describedby="dlgDesc" style="position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.35);z-index:80;padding:0">
    <div class="sheet" role="document" style="width:100%;max-width:560px;background:#fff;border-radius:16px 16px 0 0;box-shadow:0 -6px 24px rgba(0,0,0,.2)">
      <div class="sheet-h" style="display:flex;justify-content:space-between;align-items:center;padding:14px;background:#fff7fb;color:#c74363;font-weight:900;border-bottom:1px solid var(--line)"><div id="dlgTitle">ğŸ“… å‡ºç”£äºˆå®šæ—¥ã®è¨­å®š</div><button class="close-x" id="btnX" aria-label="é–‰ã˜ã‚‹" style="appearance:none;background:none;border:none;font-size:22px;line-height:1;cursor:pointer;color:#c74363">Ã—</button></div>
      <div class="sheet-b" style="padding:14px">
        <p id="dlgDesc" class="muted" style="margin-top:0">å‡ºç”£äºˆå®šæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚„ä»Šé€±ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒè‡ªå‹•ã§æ›´æ–°ã•ã‚Œã¾ã™ã€‚</p>
        <div class="field"><label for="inpDate">å‡ºç”£äºˆå®šæ—¥</label><input type="date" id="inpDate" style="width:100%;padding:12px;border:1px solid var(--line);border-radius:12px"/></div>
      </div>
      <div class="sheet-a" style="display:flex;gap:8px;padding:12px 14px;justify-content:flex-end;border-top:1px solid var(--line)">
        <button class="link" id="btnCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="link" id="btnSave">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    // ===== Auth & Session =====
    const KEY_USER='app_user';
    const KEY_HASH='app_pass_hash_v1';
    const KEY_SESSION='session_ok';
    const AUTO_LOGOUT_MIN=15; // â† ã”æŒ‡å®šã©ãŠã‚Š 15 åˆ†
    const AUTO_LOGOUT_MS=AUTO_LOGOUT_MIN*60*1000;

    async function sha256(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    function showApp(){ document.getElementById('loginView').style.display='none'; document.getElementById('app').style.display='block'; }
    function showLogin(msg){ document.getElementById('app').style.display='none'; document.getElementById('loginView').style.display='grid'; if(msg){ const n=document.getElementById('msg'); n.textContent=msg; n.className='msg ng'; } }

    // username label
    function updateUserLabel(){ const u = localStorage.getItem(KEY_USER)||''; const el=document.getElementById('userLabel'); if(el){ el.textContent = u?`ğŸ‘¤ ${u}`:'ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼'; } }

    document.getElementById('setpass').addEventListener('click', async ()=>{
      const v = document.getElementById('newpass').value.trim();
      const u = document.getElementById('user').value.trim() || 'user';
      const msg = document.getElementById('msg');
      if(!v){ msg.textContent='ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'; msg.className='msg ng'; return; }
      const h = await sha256(v);
      localStorage.setItem(KEY_USER, u);
      localStorage.setItem(KEY_HASH, h);
      msg.textContent='ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™ã€‚'; msg.className='msg ok';
    });

    document.getElementById('loginBtn').addEventListener('click', async ()=>{
      const u = document.getElementById('user').value.trim();
      const p = document.getElementById('pass').value.trim();
      const msg = document.getElementById('msg');
      const hSaved = localStorage.getItem(KEY_HASH);
      if(!hSaved){ msg.textContent='ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰æœªè¨­å®šã§ã™ã€‚ã€Œåˆå›è¨­å®šã€ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚'; msg.className='msg ng'; return; }
      const h = await sha256(p);
      if(h===hSaved){ localStorage.setItem(KEY_SESSION,'1'); localStorage.setItem(KEY_USER, u || localStorage.getItem(KEY_USER) || 'user'); showApp(); initApp(); startIdleTimer(true); }
      else { msg.textContent='ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚'; msg.className='msg ng'; }
    });

    document.getElementById('btnLogout').addEventListener('click', ()=>{ forceLogout('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚'); });

    function forceLogout(reason){
      localStorage.removeItem(KEY_SESSION);
      stopIdleTimer();
      showLogin(reason||'');
    }

    // ===== Auto Logout (Idle) =====
    let idleTimer=null; let lastActivity=Date.now();
    function resetIdle(){ lastActivity=Date.now(); if(!idleTimer) startIdleTimer(); }
    function startIdleTimer(fromLogin){
      document.getElementById('autoLogoutBanner').style.display='block';
      const check = ()=>{
        const delta = Date.now()-lastActivity;
        if(delta>=AUTO_LOGOUT_MS){ forceLogout('ç„¡æ“ä½œãŒç¶šã„ãŸãŸã‚è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚'); return; }
        idleTimer = setTimeout(check, 5000);
      };
      if(idleTimer) clearTimeout(idleTimer);
      idleTimer = setTimeout(check, 5000);
      // activity
      ['click','keydown','scroll','touchstart','pointerdown'].forEach(ev=>{
        window.addEventListener(ev, resetIdle, {passive:true});
      });
      if(fromLogin) resetIdle();
    }
    function stopIdleTimer(){ if(idleTimer){ clearTimeout(idleTimer); idleTimer=null; } }

    // ===== App Logic =====
    const STORAGE={DUE:'v24028_due',CHECK:'v24028_check'};
    const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));

    const DATA={
      applications:[{g:'å¦Šå¨ ãŒã‚ã‹ã£ãŸã‚‰',items:[{id:'app-1',title:'å¦Šå¨ å±Šå‡ºï¼ˆæ¯å­å¥åº·æ‰‹å¸³ï¼‰',desc:'åŒºä¿å¥ã‚»ãƒ³ã‚¿ãƒ¼ã§äº¤ä»˜'},{id:'app-2',title:'å¦Šå©¦æ”¯æ´çµ¦ä»˜ï¼ˆ1å›ç›®ï¼‰',desc:'5ä¸‡å††æ”¯çµ¦'}]},{g:'å‡ºç”£äºˆå®šæ—¥ã®8é€±å‰',items:[{id:'app-3',title:'å¦Šå©¦æ”¯æ´çµ¦ä»˜ï¼ˆ2å›ç›®ï¼‰',desc:'5ä¸‡å††æ”¯çµ¦'},{id:'app-4',title:'ç”£ä¼‘ç”³è«‹ï¼ˆä¼šç¤¾å“¡ï¼‰',desc:'å‹¤å‹™å…ˆã¸ç”³è«‹'}]},{g:'âš ï¸ å‡ºç”£å¾Œã™ãï¼ˆ15æ—¥ä»¥å†…ï¼‰',items:[{id:'app-5',title:'å‡ºç”Ÿå±Š',desc:'14æ—¥ä»¥å†…å¿…é ˆ'},{id:'app-6',title:'å…ç«¥æ‰‹å½“',desc:'15æ—¥ä»¥å†…å¿…é ˆï¼é…ã‚Œã‚‹ã¨å—çµ¦é–‹å§‹ãŒé…ã‚Œã¾ã™'},{id:'app-7',title:'å­ã©ã‚‚åŒ»ç™‚è²»åŠ©æˆ',desc:'ã§ãã‚‹ã ã‘æ—©ãç”³è«‹'},{id:'app-8',title:'å¥åº·ä¿é™ºåŠ å…¥',desc:'å‹¤å‹™å…ˆã¾ãŸã¯åŒºå½¹æ‰€'},{id:'app-9',title:'å‡ºç”£è‚²å…ä¸€æ™‚é‡‘',desc:'50ä¸‡å††æ”¯çµ¦'}]},{g:'ç”£å¾Œ1ã€œ2ãƒ¶æœˆ',items:[{id:'app-10',title:'å‡ºç”£æ‰‹å½“é‡‘',desc:'æ—¥çµ¦ã®ç´„2/3Ã—98æ—¥åˆ†'},{id:'app-11',title:'å›½æ°‘å¹´é‡‘ä¿é™ºæ–™å…é™¤',desc:'ç”£å‰ç”£å¾Œ4ãƒ¶æœˆåˆ†'}]},{g:'è‚²ä¼‘é–‹å§‹å‰',items:[{id:'app-12',title:'è‚²ä¼‘ç”³è«‹',desc:'å‹¤å‹™å…ˆã¸1ãƒ¶æœˆå‰ã¾ã§ã«'},{id:'app-13',title:'è‚²å…ä¼‘æ¥­çµ¦ä»˜é‡‘',desc:'æœ€åˆ180æ—¥:67%ã€ä»¥é™:50%'}]}],
      preparation:[{g:'ğŸ‘© ãƒãƒç”¨å“',items:[{id:'prep-1',title:'ç”£è¤¥ã‚·ãƒ§ãƒ¼ãƒ„',badge:'å¿…é ˆ'},{id:'prep-2',title:'æˆä¹³ãƒ–ãƒ©',badge:'å¿…é ˆ'},{id:'prep-3',title:'æ¯ä¹³ãƒ‘ãƒƒãƒ‰',badge:'å¿…é ˆ'},{id:'prep-4',title:'æˆä¹³ã‚¯ãƒƒã‚·ãƒ§ãƒ³',badge:'æ¨å¥¨'}]},{g:'ğŸ‘¶ èµ¤ã¡ã‚ƒã‚“è¡£é¡',items:[{id:'prep-10',title:'çŸ­è‚Œç€ï¼ˆ5ã€œ6æšï¼‰',badge:'å¿…é ˆ'},{id:'prep-11',title:'ã‚³ãƒ³ãƒ“è‚Œç€ï¼ˆ5ã€œ6æšï¼‰',badge:'å¿…é ˆ'},{id:'prep-12',title:'é˜²å¯’ç€ãƒ»ã‚¸ãƒ£ãƒ³ãƒ—ã‚¹ãƒ¼ãƒ„',badge:'å¿…é ˆ'}]},{g:'ğŸ¼ æˆä¹³ãƒ»èª¿ä¹³ç”¨å“',items:[{id:'prep-20',title:'å“ºä¹³ç“¶',badge:'å¿…é ˆ'},{id:'prep-21',title:'ç²‰ãƒŸãƒ«ã‚¯',badge:'æ¨å¥¨'}]},{g:'ğŸš— ãŠå‡ºã‹ã‘ç”¨å“',items:[{id:'prep-30',title:'ãƒãƒ£ã‚¤ãƒ«ãƒ‰ã‚·ãƒ¼ãƒˆ',badge:'å¿…é ˆ'},{id:'prep-31',title:'ãƒ™ãƒ“ãƒ¼ã‚«ãƒ¼',badge:'å¿…é ˆ'},{id:'prep-32',title:'æŠ±ã£ã“ç´',badge:'å¿…é ˆ'}]}],
      hospital:[{g:'ğŸ’ ãƒãƒï¼ˆåˆ†å¨©ã€œå…¥é™¢ï¼‰',items:[{id:'hosp-1',title:'æ¯å­å¥åº·æ‰‹å¸³ãƒ»ä¿é™ºè¨¼ãƒ»è¨ºå¯Ÿåˆ¸',badge:'å¿…é ˆ'},{id:'hosp-2',title:'å…¥é™¢æ›¸é¡ãƒ»å°é‘‘ãƒ»ç­†è¨˜ç”¨å…·',badge:'å¿…é ˆ'},{id:'hosp-3',title:'ç”£è¤¥ã‚·ãƒ§ãƒ¼ãƒ„ï¼ãƒŠãƒ—ã‚­ãƒ³',badge:'å¿…é ˆ'},{id:'hosp-4',title:'å‰é–‹ããƒ‘ã‚¸ãƒ£ãƒãƒ»ç¾½ç¹”ã‚Š',badge:'å¿…é ˆ'},{id:'hosp-5',title:'ã‚¹ãƒãƒ›å……é›»å™¨ï¼ˆé•·ã‚ã®ã‚±ãƒ¼ãƒ–ãƒ«ï¼‰',badge:'å¿…é ˆ'},{id:'hosp-6',title:'æ´—é¢ç”¨å…·ãƒ»ãƒªãƒƒãƒ—ãƒ»ä¿æ¹¿å‰¤',badge:'æ¨å¥¨'},{id:'hosp-7',title:'é£²ã¿ç‰©ç”¨ã‚¹ãƒˆãƒ­ãƒ¼ã‚­ãƒ£ãƒƒãƒ—',badge:'æ¨å¥¨'}]},{g:'ğŸ§¸ èµ¤ã¡ã‚ƒã‚“',items:[{id:'hosp-10',title:'è‚Œç€ãƒ»ãŠãã‚‹ã¿',badge:'æ¨å¥¨'},{id:'hosp-11',title:'ãŠã—ã‚Šãµããƒ»ã‚¬ãƒ¼ã‚¼',badge:'æ¨å¥¨'},{id:'hosp-12',title:'é€€é™¢æ™‚ã®è¡£é¡ãƒ»é˜²å¯’å…·',badge:'å¿…é ˆ'}]},{g:'ğŸ‘ª ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼',items:[{id:'hosp-20',title:'å°éŠ­ãƒ»é£²ã¿ç‰©ãƒ»è»½é£Ÿ',badge:'æ¨å¥¨'},{id:'hosp-21',title:'ã‚«ãƒ¡ãƒ©ãƒ»å……é›»æ± ',badge:'æ¨å¥¨'},{id:'hosp-22',title:'äº¤é€šæ‰‹æ®µãƒ»é§è»Šå ´ã®ç¢ºèª',badge:'å¿…é ˆ'}]},{g:'ğŸŒŸ ã‚ã‚‹ã¨ä¾¿åˆ©',items:[{id:'hosp-30',title:'å»¶é•·ã‚³ãƒ¼ãƒ‰',badge:'æ¨å¥¨'},{id:'hosp-31',title:'ã‚¹ãƒªãƒƒãƒ‘ãƒ»é´ä¸‹ï¼ˆå†¬ç”¨ï¼‰',badge:'æ¨å¥¨'},{id:'hosp-32',title:'è€³æ “ãƒ»ã‚¢ã‚¤ãƒã‚¹ã‚¯',badge:'æ¨å¥¨'}]}]
    };

    const ADVICE={0:['ç„¡ç†ã›ãšä¼‘æ¯ã‚’ã€‚ä½“èª¿ã«åˆã‚ã›ã¦éã”ã—ã¾ã—ã‚‡ã†','è‘‰é…¸ãªã©å¿…è¦ãªæ „é¤Šã‚’æ„è­˜ã—ã¦æ‘‚ã‚Šã¾ã—ã‚‡ã†'],8:['ã¤ã‚ã‚Šã®ãƒ”ãƒ¼ã‚¯æ™‚æœŸã€‚åŒ‚ã„ãƒ»æ™‚é–“å¸¯ã®å·¥å¤«ã§è»½æ¸›ã‚’','æ¯å­æ‰‹å¸³ã‚’å—ã‘å–ã‚Šã¾ã—ã‚‡ã†'],16:['å®‰å®šæœŸã«ã€‚é©åº¦ãªé‹å‹•ã‚’å§‹ã‚ã¾ã—ã‚‡ã†','æ­¯ç§‘æ¤œè¨ºã‚’å—ã‘ã¾ã—ã‚‡ã†','æˆŒã®æ—¥ã®å®‰ç”£ç¥ˆé¡˜ã‚’æ¤œè¨'],24:['ä½“é‡ç®¡ç†ã«æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†','å¦Šå¨ ç·šäºˆé˜²ã‚±ã‚¢ã‚’é–‹å§‹','ãƒ™ãƒ“ãƒ¼ç”¨å“ã®æº–å‚™ã‚’é–‹å§‹'],32:['å‡ºç”£æº–å‚™å“ãƒªã‚¹ãƒˆã‚’ä½œæˆ','é‡Œå¸°ã‚Šå‡ºç”£ã®å ´åˆã¯ç§»å‹•æ™‚æœŸã®æ¤œè¨','ç”£å¾Œã®æ‰‹ç¶šãã‚’ç¢ºèª'],36:['å…¥é™¢ãƒãƒƒã‚°ã®æº–å‚™å®Œäº†ã‚’','é™£ç—›ã‚¿ã‚¯ã‚·ãƒ¼ç™»éŒ²','ãƒãƒ¼ã‚¹ãƒ—ãƒ©ãƒ³ã‚’è©±ã—åˆã„ã¾ã—ã‚‡ã†'],40:['å‡ºç”£æº–å‚™ã¯ä¸‡å…¨ã«ã€‚ç„¦ã‚‰ãšä½“ã‚’ä¼‘ã‚ã¾ã—ã‚‡ã†']};

    const GROWTH={8:{size:'1.6cm',weight:'1g'},12:{size:'6cm',weight:'14g'},16:{size:'12cm',weight:'100g'},20:{size:'25cm',weight:'300g'},24:{size:'30cm',weight:'600g'},28:{size:'37cm',weight:'1000g'},32:{size:'42cm',weight:'1700g'},36:{size:'47cm',weight:'2500g'},40:{size:'50cm',weight:'3200g'}};

    function getActiveKey(){ const active=document.querySelector('.tabs [aria-selected="true"]'); return (active&&active.dataset.tab)||'applications'; }

    function renderList(){ const content=$('#tabContent'); const key=getActiveKey(); const kw=($('#kw')?.value||'').trim(); const data=DATA[key]; const progress=JSON.parse(localStorage.getItem(STORAGE.CHECK)||'{}'); content.innerHTML=''; const frag=document.createDocumentFragment(); let visible=0; for(const grp of data){ const matched=grp.items.filter(it=>{ if(!kw) return true; const hay=`${it.title} ${(it.desc||'')} ${(it.badge||'')}`; return hay.includes(kw);}); if(matched.length===0) continue; const g=document.createElement('section'); g.className='group'; const h=document.createElement('h3'); h.textContent=grp.g; g.appendChild(h); for(const it of matched){ const item=document.createElement('label'); item.className='item'; item.dataset.id=it.id; item.tabIndex=0; const checked=!!progress[it.id]; item.innerHTML=`<input type="checkbox" ${checked?'checked':''} aria-label="${it.title}"><div class="check">${checked?'âœ“':''}</div><div><div><strong>${it.title}</strong>${it.badge?` <span class="badge">${it.badge}</span>`:''}</div>${it.desc?`<div class="meta">${it.desc}</div>`:''}</div>`; const cb=item.querySelector('input'); function toggle(v){ cb.checked=v; item.querySelector('.check').textContent=v?'âœ“':''; progress[it.id]=v; localStorage.setItem(STORAGE.CHECK,JSON.stringify(progress)); updateProgress();} cb.addEventListener('change', e=>toggle(e.target.checked)); item.addEventListener('keydown', e=>{ if(e.key===' '||e.key==='Enter'){ e.preventDefault(); toggle(!cb.checked);} }); g.appendChild(item); visible++; } frag.appendChild(g);} if(visible===0){ const no=document.createElement('div'); no.className='nohit'; no.textContent='è©²å½“ã™ã‚‹é …ç›®ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰ãˆã¦ãŠè©¦ã—ãã ã•ã„ã€‚'; frag.appendChild(no);} content.appendChild(frag); updateProgress(); }

    function updateProgress(){ const total=$$('#tabContent .item').length||1; const done=$$('#tabContent .item input[type="checkbox"]:checked').length; const pct=Math.round(done/total*100); $('#progress').textContent=`é€²æ— ${pct}%`; }

    function updateAll(dueStr){ let due = dueStr ? new Date(dueStr) : new Date(localStorage.getItem(STORAGE.DUE) || ''); if(!due || isNaN(+due)) return; const today=new Date(); today.setHours(0,0,0,0); due.setHours(0,0,0,0); const diff=due - today; const daysLeft=Math.ceil(diff/(1000*60*60*24)); const TOTAL=280; let elapsed=TOTAL - daysLeft; if(elapsed<0) elapsed=0; if(elapsed>TOTAL) elapsed=TOTAL; const weeks=Math.floor(elapsed/7), days=elapsed%7; $('#dueDate').textContent=(due.getMonth()+1)+'/'+due.getDate(); if(daysLeft>0){ $('#daysLeft').textContent=`${daysLeft}æ—¥`; $('#dueLabel').textContent='å‡ºç”£äºˆå®šæ—¥ã¾ã§'; } else if(daysLeft===0){ $('#daysLeft').textContent='ãã‚‡ã†ï¼'; $('#dueLabel').textContent='å‡ºç”£äºˆå®šæ—¥'; } else { $('#daysLeft').textContent='èª•ç”Ÿï¼'; $('#dueLabel').textContent=`å‡ºç”£ã‹ã‚‰ ${Math.abs(daysLeft)}æ—¥`; } $('#currentWeek').textContent=`${weeks}é€±${days}æ—¥`; $('#wk').textContent=`${weeks}é€±`; let cur=8; Object.keys(GROWTH).map(Number).sort((a,b)=>a-b).forEach(w=>{ if(weeks>=w) cur=w; }); if(weeks>=40) cur=40; $('#babySize').textContent=GROWTH[cur].size; $('#babyWeight').textContent=GROWTH[cur].weight; let adv=ADVICE[0]; Object.keys(ADVICE).map(Number).sort((a,b)=>a-b).forEach(w=>{ if(weeks>=w) adv=ADVICE[w]; }); $('#adviceList').innerHTML = adv.map(x=>`<li>${x}</li>`).join(''); renderTimeline(due, weeks, days, daysLeft); }

    const TL=[{type:'week',w:28,title:'é‡Œå¸°ã‚Šå‡ºç”£ã®ç§»å‹•æ™‚æœŸã‚’ç¢ºèª',desc:'é£›è¡Œæ©Ÿãƒ»é•·è·é›¢ç§»å‹•ã®å¯å¦ã‚’ä¸»æ²»åŒ»ã¨ç›¸è«‡'},{type:'week',w:30,title:'é‡Œå¸°ã‚Šå…ˆã«é€£çµ¡ãƒ»ç´¹ä»‹çŠ¶ä¾é ¼',desc:'åˆ†å¨©äºˆç´„ã¨è¨ºç™‚æƒ…å ±æä¾›æ›¸ã®æº–å‚™'},{type:'week',w:32,title:'å…¥é™¢æº–å‚™ãƒªã‚¹ãƒˆã®ç€æ‰‹',desc:'æ¶ˆè€—å“ã‚„å­£ç¯€ç‰©ã®ä¸è¶³ã‚’ãƒã‚§ãƒƒã‚¯'},{type:'week',w:34,title:'ãƒ™ãƒ“ãƒ¼ç”¨å“ã®æœ€çµ‚ç¢ºèª',desc:'ãƒãƒ£ã‚¤ãƒ«ãƒ‰ã‚·ãƒ¼ãƒˆãƒ»è‚Œç€ãƒ»é˜²å¯’å…·'},{type:'week',w:35,title:'é™£ç—›ã‚¿ã‚¯ã‚·ãƒ¼ç™»éŒ²',desc:'é™é›ªæœŸã¯æ—©ã‚ã®ç™»éŒ²ãŒãŠã™ã™ã‚'},{type:'week',w:36,title:'å…¥é™¢ãƒãƒƒã‚°å®Œæˆ',desc:'æ¯å­æ‰‹å¸³ãƒ»æ›¸é¡ãƒ»å……é›»å™¨ãªã©æœ€çµ‚ç¢ºèª'},{type:'week',w:37,title:'ã„ã¤ã§ã‚‚å‡ºç”£OKã®ä½“åˆ¶ã¸',desc:'å¤œé–“é€£çµ¡å…ˆãƒ»äº¤é€šæ‰‹æ®µã‚’å†ç¢ºèª'},{type:'week',w:38,title:'å†·å‡ä½œã‚Šç½®ãï¼å®…é…æ‰‹é…',desc:'ç”£å¾Œã®é£Ÿäº‹ã®æ®µå–ã‚Š'},{type:'after',d:0,title:'å‡ºç”Ÿå±Šã®æº–å‚™',desc:'å¿…è¦æ›¸é¡ãƒ»è¨˜å…¥äº‹é …ã‚’ç¢ºèªï¼ˆæå‡ºã¯14æ—¥ä»¥å†…ï¼‰'},{type:'after',d:3,title:'å¥åº·ä¿é™ºã®åŠ å…¥æ‰‹ç¶šã',desc:'å‹¤å‹™å…ˆã¾ãŸã¯åŒºå½¹æ‰€'},{type:'after',d:7,title:'å­ã©ã‚‚åŒ»ç™‚è²»åŠ©æˆã®ç”³è«‹',desc:'æ—©ã‚ã«æ‰‹ç¶šã'},{type:'after',d:14,title:'å…ç«¥æ‰‹å½“ã®ç”³è«‹ï¼ˆ15æ—¥ä»¥å†…ï¼‰',desc:'é…ã‚Œã‚‹ã¨å—çµ¦é–‹å§‹ãŒé…ã‚Œã¾ã™'}];

    function renderTimeline(due,weeks,days,daysLeft){ const box=$('#timelineList'); if(!box) return; box.innerHTML=''; const today=new Date(); today.setHours(0,0,0,0); const frag=document.createDocumentFragment(); for(const it of TL){ let whenStr='',cur=false; if(it.type==='week'){ const targetElapsed=it.w*7; const delta=(targetElapsed - (weeks*7+days)); const date=new Date(today.getTime()+delta*24*3600*1000); whenStr=`å¦Šå¨ ${it.w}é€±ã”ã‚ï¼ˆ${date.getMonth()+1}/${date.getDate()}é ƒï¼‰`; cur=(weeks===it.w); } else { const date=new Date(due.getTime()+it.d*24*3600*1000); whenStr=`å‡ºç”£å¾Œ${it.d}æ—¥ã”ã‚ï¼ˆ${date.getMonth()+1}/${date.getDate()}é ƒï¼‰`; cur=(daysLeft<=0 && Math.abs(daysLeft)===it.d); } const el=document.createElement('div'); el.className='tl card2'; el.style.padding='10px 12px'; el.innerHTML=`<div class="when" style="font-weight:900;color:#c74363">${whenStr}</div><div><strong>${it.title}</strong><div class="meta">${it.desc||''}</div></div>`; frag.appendChild(el);} box.appendChild(frag); }

    function filterInfoCards(){ const kw=($('#kw')?.value||'').trim(); const cards=$$('#infoGrid .info-card'); let any=false; cards.forEach(c=>{ const hay=(c.dataset.search||c.textContent||'').replace(/\s+/g,' ').trim(); const hit=!kw||hay.includes(kw); c.style.display=hit?'':'none'; if(hit) any=true;}); if(!$('#infoNoHit')){ const d=document.createElement('div'); d.id='infoNoHit'; d.className='nohit'; d.style.display='none'; d.textContent='è©²å½“ã™ã‚‹æƒ…å ±ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'; $('#panel-info .bd')?.appendChild(d);} $('#infoNoHit').style.display=any?'none':''; }

    function initApp(){
      // Username in header
      updateUserLabel();
      // Main tabs
      (function(){ const tabs=$$('.tabbar .tabmain'); function selectTab(btn){ const target=btn.dataset.target; tabs.forEach(t=>{ const on=t===btn; t.setAttribute('aria-selected', on?'true':'false'); t.tabIndex = on?0:-1;}); ['panel-home','panel-list','panel-info'].forEach(id=>{ const show=id===target; const el=$('#'+id); if(el) el.setAttribute('aria-hidden', show?'false':'true');}); }
        tabs.forEach(btn=>btn.addEventListener('click',()=>{ if(btn.id==='btnDue'){ openDlg(); return;} selectTab(btn);}));
      })();
      // Sub tabs
      $('.tabs').addEventListener('click', (e)=>{ const b=e.target.closest('button[role="tab"]'); if(!b) return; $$('.tabs [role="tab"]').forEach(x=>x.setAttribute('aria-selected', x===b?'true':'false')); renderList(); });
      // Search
      $('#kw').addEventListener('input', ()=>{ renderList(); filterInfoCards(); });
      // Reset
      $('#btnReset').addEventListener('click', ()=>{ if(confirm('ãƒã‚§ãƒƒã‚¯çŠ¶æ³ã¨äºˆå®šæ—¥ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')){ localStorage.removeItem(STORAGE.CHECK); localStorage.removeItem(STORAGE.DUE); renderList(); updateAll(); $('#timelineList').innerHTML=''; }});
      // Modal
      const modal=$('#dlg'); let lastFocus=null; function openDlg(){ const el=$('#inpDate'); const today=new Date(); const min=new Date(today.getTime()-7*24*3600*1000*45); const max=new Date(today.getTime()+7*24*3600*1000*45); const fmt=d=>`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; el.min=fmt(min); el.max=fmt(max); el.value=localStorage.getItem(STORAGE.DUE)||fmt(today); lastFocus=document.activeElement; modal.style.display='flex'; setTimeout(()=>el.focus(),20);} function closeDlg(){ modal.style.display='none'; if(lastFocus) lastFocus.focus(); }
      $('#btnDue').addEventListener('click',openDlg); $('#btnDue2').addEventListener('click',openDlg); $('#btnCancel').addEventListener('click',closeDlg); $('#btnX').addEventListener('click',closeDlg); modal.addEventListener('click',e=>{ if(e.target===modal) closeDlg(); }); document.addEventListener('keydown',e=>{ if(modal.style.display==='flex'&&e.key==='Escape') closeDlg(); });
      $('#btnSave').addEventListener('click', ()=>{ const v=$('#inpDate').value; if(!v) return; localStorage.setItem(STORAGE.DUE, v); closeDlg(); updateAll(v); });
      // Initial renders
      if(localStorage.getItem(STORAGE.DUE)) updateAll(); renderList(); filterInfoCards();
    }

    // Boot (if authed)
    if(localStorage.getItem(KEY_SESSION)==='1'){ showApp(); initApp(); startIdleTimer(true); }
  </script>
</body>
</html>
